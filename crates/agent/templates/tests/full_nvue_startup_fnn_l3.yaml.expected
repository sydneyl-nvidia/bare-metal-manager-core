- header:
    model: VX
    nvue-api-version: nvue_v1
    rev-id: 1.0
    version: Cumulus Linux 5.6.0
- set:
    evpn:
      enable: on
    interface:
      lo:
        ip:
          address:
            127.0.0.1/32: {}
        type: loopback
      pf0dpu1_if:
        ip:
          address:
            169.254.169.253/30: {}
          vrf: vpc_10101
      pf0dpu5_if:
        ip:
          address:
            10.255.255.2/29: {}
      p0_if:
        type: swp
      p1_if:
        type: swp
      pf0hpf_if:
        type: swp
        acl: 
          p0000_deny_prefixes_ipv4:
            inbound: {}
          p0004_security_policy_override_ipv4_host_egress:          
            inbound: {}
          p0004_security_policy_override_ipv6_host_egress:
            inbound: {}
          p0004_security_policy_override_ipv4_host_ingress:
            outbound: {}
          p0004_security_policy_override_ipv6_host_ingress:
            outbound: {}
          p0010_vpc_10101_isolation_ipv4:
            inbound: {} 
        ip:
          address:
            192.168.0.0/16: {} 
          vrf: vpc_10101 
    nve:
      vxlan:
        arp-nd-suppress: on
        enable: on
        source:
          address: 127.0.0.1 
    router:
      bgp:
        autonomous-system: 65535 
        enable: on
        router-id: 127.0.0.1
      vrr:
        enable: on
      policy:
        community-list:
          BYOIP_LEAK_COMMUNITY_LIST:
            rule:
              '10':
                action: permit
                community:
                  65100:01: {}
        as-path-list:
          DPU_TO_EVPN_AS_PATH_DROP_LIST:
            rule:
              '10':
                action: permit
                aspath-exp: "^.+$"
        prefix-list:
          ALLOW_TO_UNDERLAY_PREFIX_LIST:
            rule:
              '65000':
                action: permit
                match:
                  127.0.0.1/32: {}
              '65001':
                action: permit
                match:
                  10.2.2.1/32: {}
          DPU_FROM_INSTANCE_PREFIX_LIST:
            rule:
              '1000':
                action: permit
                match:
                  5.255.255.0/24:
                    min-prefix-len: 32
              '65535':
                action: deny
                match:
                  any: {}
          DPU_FROM_TRAFFIC_INTERCEPT_PEER_PREFIX_LIST:
            rule:
              '1':
                action: permit
                match:
                  7.8.0.0/16: {}
              '65535':
                action: deny
                match:
                  any: {}
          DPU_TO_EVPN_DROP_PREFIX_LIST:
            rule:
              '10':
                action: permit
                match:
                  10.1.1.1/32: {}
        route-map:
          dpu_to_evpn:
            rule:
              '10':
                action:
                  deny: {}
                match:
                  type: ipv4
                  evpn-route-type: ip-prefix
                  ip-prefix-list: DPU_TO_EVPN_DROP_PREFIX_LIST
              '11':
                action:
                  permit: {}
                match:
                  tag: 65100
              '12':
                action:
                  permit: {}
                match:
                  tag: 65101
              '13':
                action:
                  deny: {}
                match:
                  as-path-list: DPU_TO_EVPN_AS_PATH_DROP_LIST
              '65535':
                action:
                  permit: {}
          leak_to_underlay:
            rule:
              '65533':
                action:
                  permit: {}
                match:
                  type: ipv4
                  ip-prefix-list: ALLOW_TO_UNDERLAY_PREFIX_LIST
                set:
                  community:
                    none: {}
                  large-community:
                    none: {}
              '65534':
                action:
                  permit: {}
                match:
                  tag: 65100
                set:
                  community:
                    none: {}
                  large-community:
                    none: {}
              '65535':
                action:
                  deny: {}
          dpu_from_traffic_intercept_gw_peer:
            rule:
              '10':
                action:
                  permit: {}
                match:
                  type: ipv4
                  ip-prefix-list: DPU_FROM_TRAFFIC_INTERCEPT_PEER_PREFIX_LIST
                  community-list: BYOIP_LEAK_COMMUNITY_LIST
                set:
                  tag: 65100
                  community:
                    none: {}
                  large-community:
                    none: {}
              '11':
                action:
                  permit: {}
                match:
                  type: ipv4
                  ip-prefix-list: DPU_FROM_TRAFFIC_INTERCEPT_PEER_PREFIX_LIST
                set:
                  tag: 65101
                  community:
                    none: {}
                  large-community:
                    none: {}
              '65535':
                action:
                  deny: {}
          dpu_from_instance:
            rule:
              '10':
                action:
                  permit: {}
                match:
                  type: ipv4
                  ip-prefix-list: DPU_FROM_INSTANCE_PREFIX_LIST
                  community-list: BYOIP_LEAK_COMMUNITY_LIST
                set:
                  tag: 65100
                  community:
                      none: {}
                  large-community:
                    none: {}
              '11':
                action:
                  permit: {}
                match:
                  type: ipv4
                  ip-prefix-list: DPU_FROM_INSTANCE_PREFIX_LIST
                set:
                  tag: 65101
                  community:
                      none: {}
                  large-community:
                    none: {}
              '65535':
                action:
                  deny: {}
          dpu_to_instance:
            rule:
              '10':
                action:
                  deny: {}
          dpu_to_traffic_intercept_gw_peer:
            rule:
              '10':
                action:
                  deny: {}
    system:
      reflexive-acl:
        enable: on
    vrf:
      default:
        router:
          static:
            10.2.2.1/32:
              address-family: ipv4-unicast
              via:
                10.255.255.1:
                  type: ipv4-address
          nexthop-tracking:
            ipv4:
              resolved-via-default: on
          bgp:
            address-family:
              ipv4-unicast:
                network:
                  10.2.2.1/32: {}
                enable: on
                multipaths:
                  ebgp: 128
                redistribute:
                  connected:
                    enable: on
              l2vpn-evpn:
                enable: on
            enable: on
            neighbor:
              p0_if:
                peer-group: underlay
                type: unnumbered
              p1_if:
                peer-group: underlay
                type: unnumbered
            path-selection:
              multipath:
                aspath-ignore: on
                bandwidth: ignore
            peer-group:
              routeserver:
                address-family:
                  ipv4-unicast:
                    enable: off
                  l2vpn-evpn:
                    enable: on
                    policy:
                      outbound:
                        route-map: dpu_to_evpn
                multihop-ttl: 255
                remote-as: external
                update-source: lo
              underlay:
                remote-as: external
                address-family:
                  ipv4-unicast:
                    policy:
                      outbound:
                        route-map: leak_to_underlay
                  l2vpn-evpn:
                    enable: on
                    policy:
                      outbound:
                        route-map: dpu_to_evpn  


      vpc_10101: 
        evpn:
          enable: on
          vni:
            '10101': {} 
        loopback:
          ip:
            address:
              10.1.1.1/32: {} 
        router:
          static:
            192.168.0.12/32:
              address-family: ipv4-unicast
              via:
                vlan10:
                  type: interface
          bgp:
            path-selection:
              multipath:
                aspath-ignore: on
            address-family:
              ipv4-unicast:
                network:
                  192.168.0.12/32: {}
                enable: on
                redistribute:
                  connected:
                    enable: on
                route-export:
                  to-evpn:
                    enable: on
            enable: on
            neighbor:
              192.168.0.12:
                passive-mode: on
                peer-group: tenant
                type: numbered
              10.255.255.3:
                passive-mode: on
                peer-group: traffic_intercept_gw_peer
                type: numbered
            peer-group:
              traffic_intercept_gw_peer:
                address-family:
                  ipv4-unicast:
                    policy:
                      inbound:
                        route-map: dpu_from_traffic_intercept_gw_peer
                      outbound:
                        route-map: dpu_to_traffic_intercept_gw_peer
                nexthop-connected-check: off
                remote-as: external
                timers:
                  connection-retry: 10
                  hold: 9
                  keepalive: 3
                  route-advertisement: none
              tenant:
                address-family:
                  ipv4-unicast:
                    policy:
                      inbound:
                        route-map: dpu_from_instance
                      outbound:
                        route-map: dpu_to_instance
                nexthop-connected-check: off
                remote-as: 65100
                timers:
                  connection-retry: 10
                  hold: 9
                  keepalive: 3
                  route-advertisement: none
            route-export:
              to-evpn:
                route-target:
                  11414:10101: {}
                  11415:200: {} 
                  77415:800: {}
            route-import:
              from-evpn:
                route-target:
                  11414:10101: {}
                  11414:1025186: {}
                  11414:1025197: {}
                  44444:55555: {}
                  11111:22222: {}
                  auto: {}

    acl:
      dhcp_flood_prevention:
        rule: 
          '10':
            action:
              deny: {}
            hw-offload: off
            match:
              ip:
                dest-ip: 255.255.255.255
                dest-port:
                  '67': {}
                protocol: udp
                source-port:
                  '68': {}
        type: ipv4
      p0000_deny_prefixes_ipv4:
        type: ipv4
        rule:
          '1001':
            action:
              deny: {}
            match:
              ip:
                dest-ip: 1.1.1.1/32


      p0010_vpc_10101_isolation_ipv4:
        type: ipv4
        rule:
          '1000':
            action:
              deny: {}
            match:
              ip:
                dest-ip: 2.2.2.2/32


      p0005_0_security_group_ipv4_host_egress: 
        rule:
          '2000':
            action:
              deny: {}
            match:
              ip:
                dest-ip: 1.0.0.0/0
                dest-port:
                  '80': {} 
                protocol: tcp
                source-ip: 0.0.0.0/0
                source-port:
                  '80': {}
          '2001':
            action:
              deny: {}
            match:
              ip:
                dest-ip: 1.0.0.0/0
                dest-port:
                  '81': {} 
                protocol: tcp
                source-ip: 0.0.0.0/0
                source-port:
                  '80': {}
          '2002':
            action:
              deny: {}
            match:
              ip:
                dest-ip: 1.0.0.0/0
                dest-port:
                  '80': {} 
                protocol: tcp
                source-ip: 0.0.0.0/0
                source-port:
                  '81': {}
          '2003':
            action:
              deny: {}
            match:
              ip:
                dest-ip: 1.0.0.0/0
                dest-port:
                  '81': {} 
                protocol: tcp
                source-ip: 0.0.0.0/0
                source-port:
                  '81': {}
          '2004':
            action:
              deny: {}
            match:
              conntrack:
                new: {}
                established: {}
              ip:
                dest-ip: 1.0.0.0/0
                dest-port:
                  '8080': {} 
                protocol: tcp
                source-ip: 0.0.0.0/0
          '65535':
            action:
              deny: {}
        type: ipv4
      p0005_0_security_group_ipv6_host_egress: 
        rule:
          '2000':
            action:
              deny: {}
            match:
              ip:
                dest-ip: 2001:db8:3333:4444:5555:6666:7777:9999/128
                dest-port:
                  '80': {} 
                protocol: tcp
                source-ip: 2001:db8:3333:4444:5555:6666:7777:8888/128
                source-port:
                  '80': {}
          '2001':
            action:
              deny: {}
            match:
              ip:
                dest-ip: 2001:db8:3333:4444:5555:6666:7777:9999/128
                dest-port:
                  '81': {} 
                protocol: tcp
                source-ip: 2001:db8:3333:4444:5555:6666:7777:8888/128
                source-port:
                  '80': {}
          '2002':
            action:
              deny: {}
            match:
              ip:
                dest-ip: 2001:db8:3333:4444:5555:6666:7777:9999/128
                dest-port:
                  '80': {} 
                protocol: tcp
                source-ip: 2001:db8:3333:4444:5555:6666:7777:8888/128
                source-port:
                  '81': {}
          '2003':
            action:
              deny: {}
            match:
              ip:
                dest-ip: 2001:db8:3333:4444:5555:6666:7777:9999/128
                dest-port:
                  '81': {} 
                protocol: tcp
                source-ip: 2001:db8:3333:4444:5555:6666:7777:8888/128
                source-port:
                  '81': {}
          '65535':
            action:
              deny: {}
        type: ipv6
      p0005_0_security_group_ipv4_host_ingress: 
        rule:
          '2000':
            action:
              deny: {}
            match:
              ip:
                dest-ip: 0.0.0.0/0
                dest-port:
                  '80': {} 
                protocol: tcp
                source-ip: 0.0.0.0/0
                source-port:
                  '80': {}
          '2001':
            action:
              deny: {}
            match:
              ip:
                dest-ip: 0.0.0.0/0
                dest-port:
                  '81': {} 
                protocol: tcp
                source-ip: 0.0.0.0/0
                source-port:
                  '80': {}
          '2002':
            action:
              deny: {}
            match:
              ip:
                dest-ip: 0.0.0.0/0
                dest-port:
                  '80': {} 
                protocol: tcp
                source-ip: 0.0.0.0/0
                source-port:
                  '81': {}
          '2003':
            action:
              deny: {}
            match:
              ip:
                dest-ip: 0.0.0.0/0
                dest-port:
                  '81': {} 
                protocol: tcp
                source-ip: 0.0.0.0/0
                source-port:
                  '81': {}
          '65532':
            action:
              permit: {}
            match:
              ip:
                protocol: tcp
              conntrack:
                established: {}
          '65533':
            action:
              permit: {}
            match:
              ip:
                protocol: udp
              conntrack:
                established: {}
          '65534':
            action:
              permit: {}
            match:
              ip:
                protocol: icmp
              conntrack:
                established: {}
          '65535':
            action:
              deny: {}
        type: ipv4
      p0005_0_security_group_ipv6_host_ingress: 
        rule:
          '2000':
            action:
              deny: {}
            match:
              ip:
                dest-ip: 2001:db8:3333:4444:5555:6666:7777:9999/128
                dest-port:
                  '80': {} 
                protocol: tcp
                source-ip: 2001:db8:3333:4444:5555:6666:7777:8888/128
                source-port:
                  '80': {}
          '2001':
            action:
              deny: {}
            match:
              ip:
                dest-ip: 2001:db8:3333:4444:5555:6666:7777:9999/128
                dest-port:
                  '81': {} 
                protocol: tcp
                source-ip: 2001:db8:3333:4444:5555:6666:7777:8888/128
                source-port:
                  '80': {}
          '2002':
            action:
              deny: {}
            match:
              ip:
                dest-ip: 2001:db8:3333:4444:5555:6666:7777:9999/128
                dest-port:
                  '80': {} 
                protocol: tcp
                source-ip: 2001:db8:3333:4444:5555:6666:7777:8888/128
                source-port:
                  '81': {}
          '2003':
            action:
              deny: {}
            match:
              ip:
                dest-ip: 2001:db8:3333:4444:5555:6666:7777:9999/128
                dest-port:
                  '81': {} 
                protocol: tcp
                source-ip: 2001:db8:3333:4444:5555:6666:7777:8888/128
                source-port:
                  '81': {}
          '65535':
            action:
              deny: {}
        type: ipv6

      p0004_security_policy_override_ipv4_host_egress:
        type: ipv4
        rule:
          '2000':
            action:
              deny: {}
            match:
              ip:
                dest-ip: 1.0.0.0/0
                dest-port:
                  '80': {} 
                protocol: tcp
                source-ip: 0.0.0.0/0
                source-port:
                  '80': {}
          '2001':
            action:
              deny: {}
            match:
              ip:
                dest-ip: 1.0.0.0/0
                dest-port:
                  '81': {} 
                protocol: tcp
                source-ip: 0.0.0.0/0
                source-port:
                  '80': {}
          '2002':
            action:
              deny: {}
            match:
              ip:
                dest-ip: 1.0.0.0/0
                dest-port:
                  '80': {} 
                protocol: tcp
                source-ip: 0.0.0.0/0
                source-port:
                  '81': {}
          '2003':
            action:
              deny: {}
            match:
              ip:
                dest-ip: 1.0.0.0/0
                dest-port:
                  '81': {} 
                protocol: tcp
                source-ip: 0.0.0.0/0
                source-port:
                  '81': {}
      p0004_security_policy_override_ipv6_host_egress:
        type: ipv6
        rule:
          '2000':
            action:
              deny: {}
            match:
              ip:
                dest-ip: 2001:db8:3333:4444:5555:6666:7777:9999/128
                dest-port:
                  '80': {} 
                protocol: tcp
                source-ip: 2001:db8:3333:4444:5555:6666:7777:8888/128
                source-port:
                  '80': {}
          '2001':
            action:
              deny: {}
            match:
              ip:
                dest-ip: 2001:db8:3333:4444:5555:6666:7777:9999/128
                dest-port:
                  '81': {} 
                protocol: tcp
                source-ip: 2001:db8:3333:4444:5555:6666:7777:8888/128
                source-port:
                  '80': {}
          '2002':
            action:
              deny: {}
            match:
              ip:
                dest-ip: 2001:db8:3333:4444:5555:6666:7777:9999/128
                dest-port:
                  '80': {} 
                protocol: tcp
                source-ip: 2001:db8:3333:4444:5555:6666:7777:8888/128
                source-port:
                  '81': {}
          '2003':
            action:
              deny: {}
            match:
              ip:
                dest-ip: 2001:db8:3333:4444:5555:6666:7777:9999/128
                dest-port:
                  '81': {} 
                protocol: tcp
                source-ip: 2001:db8:3333:4444:5555:6666:7777:8888/128
                source-port:
                  '81': {}
      p0004_security_policy_override_ipv4_host_ingress:
        type: ipv4
        rule:
          '2000':
            action:
              deny: {}
            match:
              ip:
                dest-ip: 0.0.0.0/0
                dest-port:
                  '80': {} 
                protocol: tcp
                source-ip: 0.0.0.0/0
                source-port:
                  '80': {}
          '2001':
            action:
              deny: {}
            match:
              ip:
                dest-ip: 0.0.0.0/0
                dest-port:
                  '81': {} 
                protocol: tcp
                source-ip: 0.0.0.0/0
                source-port:
                  '80': {}
          '2002':
            action:
              deny: {}
            match:
              ip:
                dest-ip: 0.0.0.0/0
                dest-port:
                  '80': {} 
                protocol: tcp
                source-ip: 0.0.0.0/0
                source-port:
                  '81': {}
          '2003':
            action:
              deny: {}
            match:
              ip:
                dest-ip: 0.0.0.0/0
                dest-port:
                  '81': {} 
                protocol: tcp
                source-ip: 0.0.0.0/0
                source-port:
                  '81': {}
      p0004_security_policy_override_ipv6_host_ingress:
        type: ipv6
        rule:
          '2000':
            action:
              deny: {}
            match:
              ip:
                dest-ip: 2001:db8:3333:4444:5555:6666:7777:9999/128
                dest-port:
                  '80': {} 
                protocol: tcp
                source-ip: 2001:db8:3333:4444:5555:6666:7777:8888/128
                source-port:
                  '80': {}
          '2001':
            action:
              deny: {}
            match:
              ip:
                dest-ip: 2001:db8:3333:4444:5555:6666:7777:9999/128
                dest-port:
                  '81': {} 
                protocol: tcp
                source-ip: 2001:db8:3333:4444:5555:6666:7777:8888/128
                source-port:
                  '80': {}
          '2002':
            action:
              deny: {}
            match:
              ip:
                dest-ip: 2001:db8:3333:4444:5555:6666:7777:9999/128
                dest-port:
                  '80': {} 
                protocol: tcp
                source-ip: 2001:db8:3333:4444:5555:6666:7777:8888/128
                source-port:
                  '81': {}
          '2003':
            action:
              deny: {}
            match:
              ip:
                dest-ip: 2001:db8:3333:4444:5555:6666:7777:9999/128
                dest-port:
                  '81': {} 
                protocol: tcp
                source-ip: 2001:db8:3333:4444:5555:6666:7777:8888/128
                source-port:
                  '81': {}
